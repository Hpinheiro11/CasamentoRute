<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Convite Digital 3D - Jogo do Amor</title>
<style>
  body {
    margin: 0; padding: 0;
    background: linear-gradient(135deg, #d1f0d7, #f0fff4);
    font-family: Arial, sans-serif;
    color: #2a5d34;
    text-align: center;
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  #intro {
    margin: 20px;
    z-index: 10;
  }
  #dados {
    font-size: 100px;
    margin: 40px auto 0;
    animation: tremer 0.15s infinite alternate;
    user-select: none;
  }
  @keyframes tremer {
    0% { transform: rotate(-7deg); }
    100% { transform: rotate(7deg); }
  }
  #threeContainer {
    width: 340px;
    height: 340px;
    margin: 40px auto;
    pointer-events: auto;
    z-index: 5;
    display: none; /* invisÃ­vel atÃ© revelar */
  }
  #info {
    margin-top: 30px;
    font-size: 16px;
    color: #555;
    z-index: 10;
  }
</style>
</head>
<body>

<div id="intro">
  <h2>ðŸŽ² Abana o teu telemÃ³vel para revelar o convite ðŸŽ²</h2>
  <div id="dados">ðŸŽ²ðŸŽ²</div>
  <p><em>(Toca no ecrÃ£ para ativar os sensores)</em></p>
</div>

<div id="threeContainer"></div>

<div id="info">Se o abanar nÃ£o funcionar, toca 3 vezes rÃ¡pido para abrir o convite.</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.min.js"></script>

<script>
  let threshold = 12;
  let revealed = false;
  let tapCount = 0;
  let tapTimeout = null;

  // Cria a textura do convite em canvas 2D
  function createInviteTexture() {
    const width = 512;
    const height = 512;
    const canvas = document.createElement('canvas');
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext('2d');

    // Fundo creme suave com borda arredondada
    ctx.fillStyle = '#fdfaf6';
    const radius = 40;
    ctx.beginPath();
    ctx.moveTo(radius, 0);
    ctx.lineTo(width - radius, 0);
    ctx.quadraticCurveTo(width, 0, width, radius);
    ctx.lineTo(width, height - radius);
    ctx.quadraticCurveTo(width, height, width - radius, height);
    ctx.lineTo(radius, height);
    ctx.quadraticCurveTo(0, height, 0, height - radius);
    ctx.lineTo(0, radius);
    ctx.quadraticCurveTo(0, 0, radius, 0);
    ctx.closePath();
    ctx.fill();

    // Bordas com sombra suave
    ctx.shadowColor = 'rgba(139,109,78,0.3)';
    ctx.shadowBlur = 10;
    ctx.strokeStyle = '#8b6d4e';
    ctx.lineWidth = 6;
    ctx.stroke();

    ctx.shadowColor = 'transparent'; // reset shadow

    // Texto do convite
    ctx.fillStyle = '#5b4636';
    ctx.font = 'bold 36px Georgia';
    ctx.textAlign = 'center';
    ctx.fillText('Convite Especial', width / 2, 70);

    ctx.font = '22px Georgia';
    ctx.fillText('Ã‰ com imensa alegria que', width / 2, 130);
    ctx.fillText('Rute Pinheiro e Diogo Andrade', width / 2, 160);
    ctx.fillText('convidam-te para celebrares', width / 2, 190);
    ctx.fillText('a uniÃ£o do seu amor.', width / 2, 220);

    ctx.font = 'italic 20px Georgia';
    ctx.fillStyle = '#a69072';
    ctx.fillText('"O amor verdadeiro Ã© a', width / 2, 260);
    ctx.fillText('jornada mais bela que podemos partilhar."', width / 2, 290);

    ctx.fillStyle = '#5b4636';
    ctx.font = '22px Georgia';
    ctx.fillText('Junta-te a nÃ³s no dia', width / 2, 340);
    ctx.fillText('27 de Junho, em Cantanhede,', width / 2, 370);
    ctx.fillText('para uma cerimÃ³nia Ã­ntima e', width / 2, 400);
    ctx.fillText('uma festa inesquecÃ­vel.', width / 2, 430);

    ctx.fillText('Esperamos contar contigo', width / 2, 470);
    ctx.fillText('para tornar este dia especial.', width / 2, 500);

    return new THREE.CanvasTexture(canvas);
  }

  function initThree() {
    const container = document.getElementById('threeContainer');
    const width = container.clientWidth;
    const height = container.clientHeight;

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(40, width / height, 0.1, 1000);
    camera.position.set(0, 0, 4);

    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(width, height);
    container.appendChild(renderer.domElement);

    // Luzes suaves para realÃ§ar o cubo
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
    directionalLight.position.set(5, 5, 5);
    scene.add(directionalLight);

    // Criar textura com convite
    const inviteTexture = createInviteTexture();

    // Materiais das faces: frente com o convite, outras neutras
    const materials = [
      new THREE.MeshStandardMaterial({ color: '#c8b69e' }), // direita
      new THREE.MeshStandardMaterial({ color: '#8b6d4e' }), // esquerda
      new THREE.MeshStandardMaterial({ color: '#bfae8f' }), // cima
      new THREE.MeshStandardMaterial({ color: '#a3916f' }), // baixo
      new THREE.MeshStandardMaterial({ map: inviteTexture }), // frente - convite
      new THREE.MeshStandardMaterial({ color: '#8b6d4e' })  // trÃ¡s
    ];

    const geometry = new THREE.BoxGeometry(2, 2, 2);
    const cube = new THREE.Mesh(geometry, materials);
    scene.add(cube);

    // Controls para permitir rotacionar manualmente
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.enableZoom = false;
    controls.minPolarAngle = Math.PI / 4;  // limitar Ã¢ngulo para nÃ£o virar cabeÃ§a pra baixo
    controls.maxPolarAngle = Math.PI / 1.8;

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();
  }

  // Inicializa o three.js e guarda referÃªncias
  const threeApp = initThree();

  // Mostrar convite 3D e esconder intro
  function revealInvite() {
    document.getElementById('intro').style.display = 'none';
    document.getElementById('threeContainer').style.display = 'block';
    document.getElementById('info').style.display = 'none';
  }

  function startMotionListening() {
    if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
      DeviceMotionEvent.requestPermission()
        .then(response => {
          if (response === 'granted') {
            window.addEventListener('devicemotion', motionHandler);
            document.getElementById('info').innerText = 'Sensores ativados! Abana o telemÃ³vel.';
          } else {
            document.getElementById('info').innerText = 'PermissÃ£o negada. Usa 3 toques rÃ¡pidos para abrir.';
          }
        })
        .catch(() => {
          document.getElementById('info').innerText = 'Erro a pedir permissÃ£o. Usa 3 toques rÃ¡pidos para abrir.';
        });
    } else {
      window.addEventListener('devicemotion', motionHandler);
      document.getElementById('info').innerText = 'Sensores ativados! Abana o telemÃ³vel.';
    }
  }

  function motionHandler(event) {
    if (revealed) return;

    let acc = event.accelerationIncludingGravity;
    if (!acc) return;

    let total = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);
    if (total > threshold) {
      revealed = true;
      revealInvite();
    }
  }

  // Fallback tap triplo
  window.addEventListener('touchstart', () => {
    if (revealed) return;

    tapCount++;
    if (tapTimeout) clearTimeout(tapTimeout);
    tapTimeout = setTimeout(() => {
      tapCount = 0;
    }, 600);

    if (tapCount === 3) {
      revealed = true;
      revealInvite();
    }
  });

  // Ativa sensores no primeiro toque
  window.addEventListener('click', () => {
    if (!revealed) {
      startMotionListening();
    }
  });
</script>

</body>
</html>

